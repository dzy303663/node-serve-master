{"version":3,"sources":["views/bikeMap/index.js"],"names":["BikeMap","props","_this","Object","C_Users_33101_Desktop_bikeMs_master_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","C_Users_33101_Desktop_bikeMs_master_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__","C_Users_33101_Desktop_bikeMs_master_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__","call","requestList","axios","get","url","data","params","then","res","code","setState","total_count","result","renderMap","handleFilter","Params","list","route_list","map","window","BMap","Map","gps1","split","gps2","Point","length","endPoint","centerAndZoom","addMapControl","drawBikeRoute","drawServiceArea","service_list","drawBikeIcon","bike_list","addControl","ScaleControl","anchor","BMAP_ANCHOR_TOP_RIGHT","NavigationControl","enableScrollWheelZoom","p","startPoint","startPointIcon","Icon","Size","imageSize","startMarker","Marker","icon","addOverlay","q","endPointIcon","endMarker","addEventListener","e","alert","point","lng","lat","trackPoint","i","push","polyline","Polyline","strokeColor","strokeWeight","strokeOpacity","area","lon","polygon","Polygon","fillColor","bike_List","bikeIcon","forEach","item","bikeMarker","state","bikeMapFormList","type","field","label","placeholder","initialValue","id","name","width","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","react__WEBPACK_IMPORTED_MODULE_7__","antd_es_card__WEBPACK_IMPORTED_MODULE_1__","_components_baseForm__WEBPACK_IMPORTED_MODULE_8__","formList","filterSubmit","style","marginTop","height","Component"],"mappings":"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","file":"static/js/BikeMapPage.e3978d8e.chunk.js","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport { Card } from 'antd'\nimport BaseForm from './../../components/baseForm'\nimport axios from './../../axios'\n\n\nclass BikeMap extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            total_count: 0\n        }\n        this.map = ''\n        this.bikeMapFormList = [\n            {\n                type: '城市',\n                field:'city'\n            }, {\n                type: '时间查询',\n                field:'search_time'\n            }, {\n                type: 'SELECT',\n                label: '订单状态',\n                field: 'order_status',\n                placeholder: '全部',\n                initialValue: '0',\n                list: [{ id: '0', name: '全部' }, { id: '1', name: '进行中' }, { id: '2', name: '行程结束' }],\n                width: 100\n            }\n        ]\n    }\n\n    componentDidMount() {\n        this.requestList()\n    }\n\n    requestList = () => { // 查询列表数据\n        axios.get({\n            url: '/map/bike_list',\n            data: {\n                params: this.params\n            }\n        }).then((res) => {\n            if (res.code === 0) {\n                this.setState({\n                    total_count: res.result.total_count,\n                });\n                this.renderMap(res.result);\n            }\n        });\n    };\n\n    handleFilter = (Params) => { // 查询表单\n        this.params = Params\n        this.requestList();\n    }\n\n    renderMap = (res) => {  //渲染地图数据\n\n        let list = res.route_list;// 拿到route_list数据\n        this.map = new window.BMap.Map('container');   //(初始化地图)\n        let gps1 = list[0].split(',');\n        let startPoint = new window.BMap.Point(gps1[0], gps1[1]);// 起始坐标(0:经度,1:纬度)\n        let gps2 = list[list.length - 1].split(',');\n        let endPoint = new window.BMap.Point(gps2[0], gps2[1]);// 终点坐标\n\n        this.map.centerAndZoom(endPoint, 11); // 保证地图居中 \n\n        // //起点 -- 图标Icon/覆盖物Marker/添加addOverlay\n        // let startPointIcon = new window.BMap.Icon('/assets/start_point.png', new window.BMap.Size(36, 42), { // 设置图片样式\n        //     imageSize: new window.BMap.Size(36, 42),\n        //     anchor: new window.BMap.Size(18, 42) // 偏移\n        // });\n\n        // let bikeMarkerStart = new window.BMap.Marker(startPoint, { icon: startPointIcon });\n        // this.map.addOverlay(bikeMarkerStart);\n\n\n        // // 终点\n        // let endPointIcon = new window.BMap.Icon('/assets/end_point.png', new window.BMap.Size(36, 42), {\n        //     imageSize: new window.BMap.Size(36, 42),\n        //     anchor: new window.BMap.Size(18, 42)\n        // });\n        // let bikeMarkerEnd = new window.BMap.Marker(endPoint, { icon: endPointIcon });\n        // this.map.addOverlay(bikeMarkerEnd);\n\n\n        // bikeMarkerEnd.addEventListener(\"click\", function (e) {\n        //     alert(\"当前位置：\" + e.point.lng + \", \" + e.point.lat);\n        // });\n\n\n        // 调用添加地图控件方法\n        this.addMapControl()\n        // 调用路线图绘制方法\n        this.drawBikeRoute(res.route_list)\n        // 调用服务区绘制方法\n        this.drawServiceArea(res.service_list)\n        // 调用车辆图标绘制方法\n        this.drawBikeIcon(res.bike_list)\n\n    }\n\n    addMapControl = () => { //添加地图控件\n        let map = this.map\n        map.addControl(new window.BMap.ScaleControl({ anchor: window.BMAP_ANCHOR_TOP_RIGHT }))\n        map.addControl(new window.BMap.NavigationControl({ anchor: window.BMAP_ANCHOR_TOP_RIGHT }))\n        map.enableScrollWheelZoom(true);   //开启鼠标滚轮缩放\n    }\n\n    drawBikeRoute = (route_list) => { //绘制路线图\n        if (route_list.length > 0) {\n            // 绘制起点坐标icon\n            let first = route_list[0]\n            let p = first.split(',')\n            let startPoint = new window.BMap.Point(p[0], p[1])\n            let startPointIcon = new window.BMap.Icon('/assets/start_point.png', new window.BMap.Size(36, 42), {\n                imageSize: new window.BMap.Size(36, 42),\n                anchor: new window.BMap.Size(18, 42) //偏移\n            })\n            let startMarker = new window.BMap.Marker(startPoint, { icon: startPointIcon })\n            this.map.addOverlay(startMarker)\n\n            // 绘制终点坐标icon\n            let last = route_list[route_list.length - 1]\n            let q = last.split(',')\n            let endPoint = new window.BMap.Point(q[0], q[1])\n            let endPointIcon = new window.BMap.Icon('/assets/end_point.png', new window.BMap.Size(36, 42), {\n                imageSize: new window.window.BMap.Size(36, 42),\n                anchor: new window.BMap.Size(18, 42)\n            })\n            let endMarker = new window.BMap.Marker(endPoint, { icon: endPointIcon })\n            this.map.addOverlay(endMarker)\n\n            endMarker.addEventListener(\"click\", function (e) {\n                alert(\"当前位置：\" + e.point.lng + \", \" + e.point.lat);\n            });\n\n            //绘制行驶路线\n            let trackPoint = []\n            for (let i = 0; i < route_list.length; i++) {\n                let point = route_list[i].split(',')\n                trackPoint.push(new window.BMap.Point(point[0], point[1]))\n            }\n            let polyline = new window.BMap.Polyline(trackPoint, {\n                strokeColor: '#000000',\n                strokeWeight: 4,\n                strokeOpacity: 1\n            })\n            this.map.addOverlay(polyline)\n            this.map.centerAndZoom(endPoint, 11)\n\n        }\n    }\n\n    drawServiceArea = (area) => { //绘制服务区\n        let trackPoint = []\n        for (let i = 0; i < area.length; i++) {\n            let point = area[i]\n            trackPoint.push(new window.BMap.Point(point.lon, point.lat))\n        }\n        let polygon = new window.BMap.Polygon(trackPoint, { //包围服务区的折线\n            strokeColor: '#ef4136',\n            strokeWeight: 3,\n            strokeOpacity: 1,\n            fillColor: ''\n        })\n        this.map.addOverlay(polygon)\n    }\n\n    drawBikeIcon = (bike_List) => {// 添加地图中的自行车图标\n        \n        let bikeIcon = new window.BMap.Icon('/assets/bike.jpg', new window.BMap.Size(36, 42), {\n            imageSize: new window.BMap.Size(36, 42),\n            anchor: new window.BMap.Size(18, 42)\n        });\n        bike_List.forEach((item) => {\n            let p = item.split(',');\n            let point = new window.BMap.Point(p[0], p[1]);\n            let bikeMarker = new window.BMap.Marker(point, { icon: bikeIcon });\n            this.map.addOverlay(bikeMarker);\n        });\n    }\n\n\n    render() {\n        return (\n            <Fragment>\n                <Card>\n                    <BaseForm formList={this.bikeMapFormList} filterSubmit={this.handleFilter} />\n                </Card>\n                <Card style={{ marginTop: 10 }}>\n                    <div>共 {this.state.total_count} 辆车</div>\n                    <div id=\"container\" style={{ height: 500 }}></div>\n                </Card>\n            </Fragment>\n        );\n    }\n}\n\nexport default BikeMap;"],"sourceRoot":""}